# -*- mode: tqfolder -*-

################################################################
## SR optimization: tau eta, visible mass, dphi, MT
#################################################################

$include("AHZ-lephad/config/common/cuts/cuts.def");

@ */CutMaterialCorrection {
    +CutTruth {
        <.cutExpression="{ $(isData) || $(isSig) || ($(isTTL) && ([TruthTauSelector] == 20 || [TruthTauSelector] == 5 ||[TruthTauSelector] == 30)) || 
         ($(isJet) && [TruthTauSelector] == -30)}",
         .weightExpression="{$(isData) ? 1 : [ScaleFactor]}", .title="Truth">

        +CutLeptonBasic {
            <.cutExpression="lep_0_p4.Pt() > 30 && lep_0_id_medium ==1", .title = "Lepton basic cut">
        
            +CutTauBasic {
                <.cutExpression="tau_0_p4.Pt() > 25 && fabs(tau_0_p4.Eta()) < 2.3 && 
                    (tau_0_n_charged_tracks == 1 || tau_0_n_charged_tracks == 3) ", .title="Tau basic cut">
                
                +CutLeptonISO {
                    <.cutExpression="($(isMultiJetsFake) ? $(isFailISO) : $(isPassISO))",
                     .weightExpression="($(isMultiJetsFake) ? ($(MultiJetsLFF))*($(LeptonFakeNom)) : 1)", .title="Lepton isolation">

                    +CutTauID {
                        <.cutExpression="$(isddOtherJetsFake) ? $(isFailID) : $(isPassID)", .title="Tau ID",
                         .weightExpression="$(isddOtherJetsFake) ? ($(OtherJetsTFF))*($(TauFakeNom)) : 1">

                        +CutOS {
                            <.cutExpression="lephad_qxq == -1", .title="OS", regionCharge="OS">
                        
                            +CutLepHad {
                                <.cutExpression="lephad_dphi>2.4", .title="Lephad dphi">
                            } #End: CutLepHad
                        } #End: CutOS
                    } #End: CutTauID
                } #End: CutLeptonISO
            } #End: CutTauBasic
        } #End: CutLeptonBasic
    } #End: CutTruth
} #End: CutMaterialCorrection
        


# Divide to 0Btag/Btag region
@ */CutLepHad {
    +CutBveto {
        <.cutExpression="$(NbJets)==0", .title="Bveto", BJET="Bveto">
    } #End: CutBveto

    +CutBtag {
        <.cutExpression="$(NbJets)>=1", .title="Btag", BJET="Btag",
         .weightExpression="$(isTop) && $(ApplyTopSF) ? $(TopSF) : 1">
    } #End: CutBtag
} #End: CutLepHad



# Divide to different MT region
@ */CutB* {
    +Cut$(BJET)NoMT {
        <.cutExpression="1", .title=$(BJET)NoMT>
    }
    +Cut$(BJET)LowMT {
        <.cutExpression="lephad_mt_lep0_met < 40", .title="$(BJET)LowMT">
    } 
    +Cut$(BJET)MediumMT {
        <.cutExpression="lephad_mt_lep0_met >= 40 && lephad_mt_lep0_met<60", .title="$(BJET)MediumMT">
    }
    +Cut$(BJET)HighMT {
        <.cutExpression="$(NbJets)==0 ? lephad_mt_lep0_met>=150 : lephad_mt_lep0_met>=220", .title="$(BJET)HighMT">
    }
}



$replace("*/CutBveto/*:.name,.title", BJET="Bveto");
$replace("*/CutBtag/*:.name,.title", BJET="Btag");
