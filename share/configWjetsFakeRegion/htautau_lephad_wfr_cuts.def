# -*- mode: tqfolder -*-

################################################################
##
##  FAKE FACTOR WFR
##
##  Cuts for Wjet FR FF.
##  MC subtraction is made only with truth matched events, so
##      use inclusive samples and truth match them.
##  Use separate truth matching for studies and plotting.
##  Both SS and OS regions are included in this file:
##      SS for btag, OS for bveto.
#################################################################

$include("configCommon/htautau_lephad_common_cuts.def");

@*/CutBase{
    +CutTruth{
        <.cutExpression = "{ ($(isData)||$(isFailISO)) ? 1 : ( $(isInc)? ([TruthSelector]==30 || [TruthSelector]==20 || [TruthSelector]==5) :
                            (  ($(isTT)&&[TruthSelector]==30) || ($(isTL)&&([TruthSelector]==20||[TruthSelector]==5)) || ($(isJET)&&[TruthSelector]==-30) ) ) }",
                            .weightExpression = "{ $(isData) ? 1 : [ScaleFactor_$(weightvariation)] }", .title="Truth">
        +CutAll {
            <.cutExpression = " [lep_0_id_medium==1 && lep_0_p4.Pt()>30 && tau_0_p4.Pt()>25 && fabs(tau_0_p4.Eta())<2.3 &&
                                 tau_0_jet_bdt_score_trans>0.01 && lephad_dphi>2.4] && [$(isFailISO)?((lep_0==2 && lep_0_iso_Gradient==0) || (lep_0==1 && ( (lep_0_p4.Pt()<50. && lep_0_iso_FCTightTrackOnly==0) || (lep_0_p4.Pt()>=50. && lep_0_iso_FCTight==0) ))):((lep_0==2 && lep_0_iso_Gradient==1) || (lep_0==1 && ( (lep_0_p4.Pt()<50. && lep_0_iso_FCTightTrackOnly==1) || (lep_0_p4.Pt()>=50. && lep_0_iso_FCTight==1) )))] ",
                                 .weightExpression = "$(isFailISO)?[isoreweight_$(isovar)]:1", .title="All">
            +CutVisMassVeto {
                # vis mass veto only in ehad bveto channel.
                <.cutExpression=" (lep_0==2 && n_bjets==0)? ( (lephad_p4.M() > 110 || lephad_p4.M() < 80)? 1 : 0 ) : 1 ", .title="Vis mass veto">
                +CutMTOS{
                    <.cutExpression = "lephad_mt_lep0_met>60. && lephad_mt_lep0_met<150. && lephad_qxq==-1", .title="MTOS">
                    +CutBveto1pOSPassID{
                        <.cutExpression = "n_bjets == 0 && tau_0_n_charged_tracks==1 && tau_0_jet_bdt_medium==1", .title="Bveto1pOSPassID">
                        }
                    +CutBveto3pOSPassID{
                        <.cutExpression = "n_bjets == 0 && tau_0_n_charged_tracks==3 && tau_0_jet_bdt_medium==1", .title="Bveto3pOSPassID",>
                        }
                    +CutBveto1pOSFailID{
                        <.cutExpression = "n_bjets == 0 && tau_0_n_charged_tracks==1 && tau_0_jet_bdt_medium==0", .title="Bveto1pOSFailID">
                        }
                    +CutBveto3pOSFailID{
                        <.cutExpression = "n_bjets == 0 && tau_0_n_charged_tracks==3 && tau_0_jet_bdt_medium==0", .title="Bveto3pOSFailID",>
                        }
                    }
                }
            }
        }

    }

@*/CutMTOS {
    +CutBtag1pOSPassID{
        <.cutExpression = "n_bjets > 0 && tau_0_n_charged_tracks==1 && tau_0_jet_bdt_medium==1", .title="Btag1pOSPassID">
        }
    +CutBtag3pOSPassID{
        <.cutExpression = "n_bjets > 0 && tau_0_n_charged_tracks==3 && tau_0_jet_bdt_medium==1", .title="Btag3pOSPassID",>
        }
    +CutBtag1pOSFailID{
        <.cutExpression = "n_bjets > 0 && tau_0_n_charged_tracks==1 && tau_0_jet_bdt_medium==0", .title="Btag1pOSFailID">
        }
    +CutBtag3pOSFailID{
        <.cutExpression = "n_bjets > 0 && tau_0_n_charged_tracks==3 && tau_0_jet_bdt_medium==0", .title="Btag3pOSFailID",>
        }
    }

# This is SS region, used for btag only:
@*/CutAll {
    +CutMTSS{
        <.cutExpression = "[lephad_mt_lep0_met>60. && lephad_qxq==1]", .title="MTSS">
        +CutBveto1pSSPassID{
            <.cutExpression = "n_bjets == 0 && tau_0_n_charged_tracks==1 && tau_0_jet_bdt_medium==1", .title="Bveto1pSSPassID">
            }
        +CutBveto3pSSPassID{
            <.cutExpression = "n_bjets == 0 && tau_0_n_charged_tracks==3 && tau_0_jet_bdt_medium==1", .title="Bveto3pSSPassID",>
            }
        +CutBveto1pSSFailID{
            <.cutExpression = "n_bjets == 0 && tau_0_n_charged_tracks==1 && tau_0_jet_bdt_medium==0", .title="Bveto1pSSFailID">
            }
        +CutBveto3pSSFailID{
            <.cutExpression = "n_bjets == 0 && tau_0_n_charged_tracks==3 && tau_0_jet_bdt_medium==0", .title="Bveto3pSSFailID",>
            }

        +CutBtag1pSSPassID{
            <.cutExpression = "n_bjets > 0 && tau_0_n_charged_tracks==1 && tau_0_jet_bdt_medium==1", .title="Btag1pSSPassID">
            }
        +CutBtag3pSSPassID{
            <.cutExpression = "n_bjets > 0 && tau_0_n_charged_tracks==3 && tau_0_jet_bdt_medium==1", .title="Btag3pSSPassID",>
            }
        +CutBtag1pSSFailID{
            <.cutExpression = "n_bjets > 0 && tau_0_n_charged_tracks==1 && tau_0_jet_bdt_medium==0", .title="Btag1pSSFailID">
            }
        +CutBtag3pSSFailID{
            <.cutExpression = "n_bjets > 0 && tau_0_n_charged_tracks==3 && tau_0_jet_bdt_medium==0", .title="Btag3pSSFailID",>
            }

        }
    }
