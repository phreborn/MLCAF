# -*- mode:tqfolder -*-

################################################################
##
##  Acceptance challenge for signal.
##  If you want to do that for other MC, be sure to put in
##      appropriate truth matching.
##
#################################################################
+CutChannel{
    <.cutExpression = " ('$(channel)'=='muhad' && lep_0==1) || ('$(channel)'=='ehad' && lep_0==2 ) || ('$(channel)'=='lephad') ", .title="Channel">
    +CutBase {
        <.cutExpression = " { $(isData) ? 1 : (($(dsid)==361106 || $(dsid)==361107 || $(dsid)==361108) ? (parent_m < 120 ? 1 : 0) : 1) } ",
            .weightExpression = "weight_mc*NOMINAL_pileup_combined_weight",
            .title="Base Cut">
            +CutTrigger {
                <.cutExpression = "( [bsmtriggerdecision]==1 )",
                .weightExpression = "lep_0==2?(lep_0_NOMINAL_EleEffSF_SINGLE_E_2015_e24_lhmedium_L1EM20VH_OR_e60_lhmedium_OR_e120_lhloose_2016_e26_lhtight_nod0_ivarloose_OR_e60_lhmedium_nod0_OR_e140_lhloose_nod0_MediumLLH_d0z0_v11_isolGradient):
                (lep_0_pt>55?(lep_0_NOMINAL_MuEffSF_HLT_mu50_QualMedium_IsoNone):(NOMINAL_pileup_random_run_number>290000?(lep_0_NOMINAL_MuEffSF_HLT_mu26_ivarmedium_QualMedium_IsoNone):(lep_0_NOMINAL_MuEffSF_HLT_mu20_iloose_L1MU15_QualMedium_IsoNone)))",
                 .title="Trigger">
                +CutOS{
                    <.cutExpression = "lephad_qxq==-1", .title="OS">
                    +CutLeptonPt{
                        <.cutExpression = "lep_0_pt > 30",
                        .weightExpression = "lep_0==2?(lep_0_NOMINAL_EleEffSF_offline_RecoTrk) : (lep_0_NOMINAL_MuEffSF_Reco_QualMedium)",

                        .title="Lepton Pt">
                        +CutLeptonISO{
                            <.cutExpression = "lep_0_iso_Gradient==1",
                            .weightExpression = "lep_0==2?(lep_0_NOMINAL_EleEffSF_Isolation_MediumLLH_d0z0_v11_isolGradient) : (lep_0_NOMINAL_MuEffSF_IsoGradient)",
                             .title="Lepton ISO">
                            +CutLeptonID{
                                <.cutExpression = "lep_0_id_medium==1",
                                .weightExpression = "lep_0==2?(lep_0_NOMINAL_EleEffSF_offline_MediumLLH_d0z0_v11) : (lep_0_NOMINAL_MuEffSF_TTVA)",
                                .title="Lepton ID">
                                +CutTauPtEta{
                                    <.cutExpression = "tau_0_pt>25 && fabs(tau_0_eta)<2.3",
                                    .weightExpression = "tau_0_NOMINAL_TauEffSF_selection",
                                    .title="Tau Pt,Eta">
                                    +CutTauID{
                                        <.cutExpression = "tau_0_jet_bdt_medium==1",
                                        .weightExpression = "tau_0_NOMINAL_TauEffSF_JetBDTmedium",
                                        .title="Tau ID">
                                        +CutDphi{
                                            <.cutExpression = "lephad_dphi>2.4", .title="Dphi">
                                            +CutVisMassVeto {
                                                <.cutExpression=" lep_0==1? 1 : ( (lephad_vis_mass > 110 || lephad_vis_mass < 80)? 1 : 0 ) ", .title="Vis mass veto">
                                                +CutMT{
                                                    <.cutExpression = "[lepmet_mt]<40.",
                                                    .weightExpression = "jet_NOMINAL_central_jets_global_effSF_JVT * jet_NOMINAL_central_jets_global_ineffSF_JVT *
                                                                        jet_NOMINAL_global_effSF_MVX * jet_NOMINAL_global_ineffSF_MVX",
                                                    .title="MT">
                                                    +CutBveto1p{
                                                        <.cutExpression = "n_bjets == 0 && tau_0_n_tracks==1", .title="Bveto1p">
                                                        }
                                                    +CutBtag1p{
                                                        < .cutExpression = "n_bjets > 0 && tau_0_n_tracks==1", .title="Btag1p",>
                                                        }
                                                    +CutBveto3p{
                                                        <.cutExpression = "n_bjets == 0 && tau_0_n_tracks==3", .title="Bveto3p">
                                                        }
                                                    +CutBtag3p{
                                                        < .cutExpression = "n_bjets > 0 && tau_0_n_tracks==3", .title="Btag3p",>
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }
        }
    }

