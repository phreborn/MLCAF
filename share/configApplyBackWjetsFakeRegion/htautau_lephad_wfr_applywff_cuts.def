# -*- mode:tqfolder -*-

################################################################
##
##  FAKE FACTOR WCR
##
##  Cuts for Wjet CR FF.
##  MC subtraction is made only with truth matched events, so
##      use inclusive samples and truth match them.
##  Use separate truth matching for studies and plotting.
##  Both SS and OS regions are included in this file:
##      SS for btag, OS for bveto.
#################################################################

$include("ConfigCommon/htautau_lephad_common_cuts.def");

@*/CutBase{
    +CutTruth{
        <.cutExpression = "{ ($(isData)||$(isFailISO)) ? 1 : ( $(isInc) && ([TruthSelector]==30 || [TruthSelector]==20 || [TruthSelector]==5))}",
         .weightExpression = "{ $(isData) ? 1 : [ScaleFactor_$(weightvariation)] }", .title="Truth">
        +CutAll {
            <.cutExpression = " [lep_0_id_medium==1 && lep_0_p4.Pt()>30 && tau_0_p4.Pt()>25 && fabs(tau_0_p4.Eta())<2.3 && tau_0_jet_bdt_score_trans>0.01 && lephad_dphi>2.4] && [$(isFailISO)?lep_0_iso_Gradient==0:lep_0_iso_Gradient==1] ",
            #<.cutExpression = " [lephad_met_lep1_cos_dphi>=2.5 && lephad_met_lep1_cos_dphi<3.15 && lep_0_id_medium==1 && lep_0_p4.Pt()>30 && tau_0_p4.Pt()>25 && fabs(tau_0_p4.Eta())<2.3 && tau_0_jet_bdt_score_trans>0.01 && lephad_dphi>2.4] && [$(isFailISO)?lep_0_iso_Gradient==0:lep_0_iso_Gradient==1] ",
                                 .weightExpression = "$(isFailISO)?[isoreweight_$(isovar)]:1", .title="All">
          +CutTop{
            <.cutExpression = " 1 ", .weightExpression = "$(isTop)? [bsmlephad_topsys_$(ttbarweight)]:1.", .title="TopSys"> 
            +CutID{
                <.cutExpression = "$(isFailID) ? tau_0_jet_bdt_medium==0 : tau_0_jet_bdt_medium==1", 
                      .weightExpression = "$(isFailID) ? [ptreweight_$(fakevar)] : 1",.title="ID">
                +CutWCRVisMassVeto {
                    # vis mass veto only in ehad bveto channel.
                    <.cutExpression=" (lep_0==2 && n_bjets==0)? ( (lephad_p4.M() > 110 || lephad_p4.M() < 80)? 1 : 0 ) : 1 ", .title="Vis mass veto WCR">
                    +CutWCRMTOS{
                        <.cutExpression = "[lephad_mt_lep0_met>60.] && [lephad_mt_lep0_met<150.] && [lephad_qxq==-1]",.title="WCRMTOS">
                        +CutWCRBveto1pOSPassID{
                            <.cutExpression = "n_bjets == 0 && tau_0_n_charged_tracks==1", .title="WCRBveto1pOSPassID">
                            }
                        +CutWCRBveto3pOSPassID{
                            <.cutExpression = "n_bjets == 0 && tau_0_n_charged_tracks==3", .title="WCRBveto3pOSPassID",>
                            }
                        }
                    }
                }
              }
            }
        }
    }


# This is SS region, used for btag only:
@*/CutID {
    +CutWCRMTSS{
        <.cutExpression = "lephad_mt_lep0_met>60. && lephad_qxq==1",.title="WCRMTSS">
        +CutWCRBtag1pSSPassID{
            <.cutExpression = "n_bjets > 0 && tau_0_n_charged_tracks==1", .title="WCRBtag1pSSPassID">
            }
        +CutWCRBtag3pSSPassID{
            <.cutExpression = "n_bjets > 0 && tau_0_n_charged_tracks==3", .title="WCRBtag3pSSPassID",>
            }
        }
    }


