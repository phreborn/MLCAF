# -*- mode: tqfolder -*-

################################################################
##
##  Basic cuts for Fake Lepton CR.
##
##  Application of ScaleFactor is not entirely logical because
##      if there is no tau then SF=0. If we use jets, dont apply full SF,
##      but if taus only then use SF.
##
#################################################################

$include("lqtaub_lephad/config-Common/cuts/cuts.def");

@ */CutMaterialCorrection {
    +CutAll {
        <.cutExpression="lep_0_id_medium == 1 && lep_0_p4.Pt() > 30  && lephad_mt_lep0_met < 30",
         .weightExpression="{$(isData) ? 1 : [ScaleFactor]}", .title="All">

        +CutTau {
            <.cutExpression="$(TauIDScore) < $(TauIDScoreCut) && n_taus > 0", .title="Tau">

            +CutSingleLepton {
                <.cutExpression="(n_electrons + n_muons) == 1", .title="SingleLepton">

                +CutBvetoCategory {
                    <.cutExpression="$(NbJets) == 0", .title="BvetoCategory", region="veto">
                } #End: CutBvetoCategory

                +CutBtagCategory {
                    <.cutExpression="$(NbJets) > 0", .title="BtagCategory", region="tag">
                } #End: CutBtagCategory
            } #End: CutSingleLepton
        } #End: CutTau
    } #End: CutAll
} #End: CutMaterialCorrection

@ */CutB*Category {
    +CutB$(region)PassISO {
        <.cutExpression="($(isAntiISO) ? $(isFailISO) : $(isPassISO))",
         .weightExpression="($(isAntiISO) ? $(applyLFF) : 1)", .title="B$(region)PassISO">
    } #End: CutB$(region)PassISO

    +CutB$(region)FailISO {
        <.cutExpression="($(isAntiISO) ? $(isPassISO) : $(isFailISO))",
         .weightExpression="($(isAntiISO) ? 1 / $(applyLFF) : 1)", .title="B$(region)FailISO">
    } #End: CutB$(region)FailISO
} #End: CutB*Category

$replace("*/CutBvetoCategory/*:*", region="veto");
$replace("*/CutBtagCategory/*:*", region="tag");
