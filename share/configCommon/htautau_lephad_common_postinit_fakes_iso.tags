# -*- mode: tqfolder -*-

# for use in including derived fake contributions from the anti-ISO region
# as this is post-initialize, the MC samples should already have their weights collected
$printline("Including ISO fakes...");

# create /bkg SampleFolders for ISO fakes
$create(path="/bkg/?/?/Fakes/ISO/data", type="sf");
$create(path="/bkg/?/?/Fakes/ISO/mc", type="sf");

# copy /data into the /bkg/.../Fakes folder
@ /data/?/?/? {
    $copy("../$(BASEFOLDERNAME) >> /bkg/$(channel)/$(campaign)/Fakes/ISO/data");
}
# copy each /bkg into the Fakes folder, including Wjets MC
@ /bkg/? {
    @ ? {
        $copy("Ztautau >> Fakes/ISO/mc");
        $copy("Zll     >> Fakes/ISO/mc");
        $copy("Top     >> Fakes/ISO/mc");
        $copy("Diboson >> Fakes/ISO/mc");
        $copy("Wjets   >> Fakes/ISO/mc");
    }
}

# tag the anti-iso region
<isAntiISO=false> @ /.;
<isAntiISO=true> @ /bkg/?/?/Fakes/ISO;

# re-mark fake data as data
<isFailData=false> @ /.;
<isFailData=true> @ /bkg/?/?/Fakes/ISO/data;
<isData=true> @ /bkg/?/?/Fakes/ISO/data;

# re-set cutflow counter and histogram pooling higher in the data sample folder
# this also helps to reduce memory consumption
<.aj.pool.counters=true, .aj.pool.histograms=true> @ /bkg/?/?/Fakes/ISO/data;
