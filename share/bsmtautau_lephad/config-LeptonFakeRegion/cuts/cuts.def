# -*- mode: tqfolder -*-

################################################################
##
##  Basic cuts for Fake Lepton CR.
##
##  Application of ScaleFactor is not entirely logical because
##      if there is no tau then SF=0. If we use jets, dont apply full SF,
##      but if taus only then use SF.
##
#################################################################

$include("bsmtautau_lephad/config-Common/cuts/cuts.def");

@ */CutMaterialCorrection {
    +CutAll {
        <.cutExpression="lep_0_id_medium == 1 && lep_0_p4.Pt() > 30  && lephad_mt_lep0_met < 30",
         .weightExpression="{$(isData) ? 1 : [ScaleFactor]}", .title="All">

        +CutTau {
            <.cutExpression="tau_0_jet_bdt_score_trans < 0.01 && n_taus > 0", .title="Tau">

            +CutSingleLepton {
                <.cutExpression="(n_electrons + n_muons) == 1", .title="SingleLepton">

                +CutBveto {
                    <.cutExpression="n_bjets == 0", .title="Bveto">

                    +CutBvetoPassISO {
                        <.cutExpression="($(isAntiISO) ? $(isFailISO) : $(isPassISO))",
                         .weightExpression="($(isAntiISO) ? $(applyLFF) : 1)", .title="BvetoPassISO">
                    } #End: CutBvetoPassISO

                    +CutBvetoFailISO {
                        <.cutExpression="($(isAntiISO) ? $(isPassISO) : $(isFailISO))",
                         .weightExpression="($(isAntiISO) ? 1 / $(applyLFF) : 1)", .title="BvetoFailISO">
                    } #End: CutBvetoFailISO
                } #End: CutBveto

                +CutBtag {
                    <.cutExpression="n_bjets > 0", .title="Btag">

                    +CutBtagPassISO {
                        <.cutExpression="($(isAntiISO) ? $(isFailISO) : $(isPassISO))",
                         .weightExpression="($(isAntiISO) ? $(applyLFF) : 1)", .title="BtagPassISO">
                    } #End: CutBtagPassISO

                    +CutBtagFailISO {
                        <.cutExpression="($(isAntiISO) ? $(isPassISO) : $(isFailISO))",
                         .weightExpression="($(isAntiISO) ? 1 / $(applyLFF) : 1)", .title="BtagFailISO">
                    } #End: CutBtagFailISO
                } #End: CutBtag
            } #End: CutSingleLepton
        } #End: CutTau
    } #End: CutAll
} #End: CutMaterialCorrection
