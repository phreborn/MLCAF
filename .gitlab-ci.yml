
stages:
  - build
  - run
  - docker

variables:
  GIT_SUBMODULE_STRATEGY: recursive
  GIT_SSL_NO_VERIFY: "true"
  FROM: atlas/analysisbase:21.2.23

build:
  image: atlas/analysisbase:21.2.23
  stage: build
  script:
    - source /home/atlas/release_setup.sh
    - mkdir build
    - cd build
    - cmake ..
    - make -j4
  artifacts:
    expire_in: 1d
    untracked: true
    paths:
      - build
      - CAFCore/cafsetup.sh

run:
  image: atlas/analysisbase:21.2.23
  stage: run
  dependencies:
    - build
  script:
    - source /home/atlas/release_setup.sh
    - source CAFCore/cafsetup.sh
    - cd share
    - ./prepare.py nTuple/config/master/prepare-ZjetsFF-Example.cfg
    - ./initialize.py nTuple/config/master/initialize-ZjetsFF-Example.cfg
    - ./analyze.py nTuple/config/master/analyze-ZjetsFF-Example.cfg
    - ./visualize.py nTuple/config/master/visualize-ZjetsFF-Example.cfg
  artifacts:
    paths:
      - share/sampleFolders
      - share/results
    name: "share_${CI_JOB_NAME}"
    expire_in: 3 mos


build_image:
  stage: docker
  tags:
    - docker-image-build
  script:
    - ignore


